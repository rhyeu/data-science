# xwMOOC 데이터 과학
xwMOOC  
2017-08-01  
 


## 1. 인터넷 쇼핑 사이트, 소셜 커머스

기존 인터넷 쇼핑 사이트에 더하여 소셜 커머스 3사가 신규로 의미있는 경쟁을 만들어 내고 있다.
[‘엇갈린 실적’ 위메프만 웃었다…쿠팡·티몬, 적자 더 늘어](http://www.ddaily.co.kr/news/article.html?no=154946) 기사는 
작년 감사보고서를 통해 쿠팡, 티몬, 위메프를 비교했다. 

그럼 이러한 재무정보 이전에 웹트래픽과 함께 상거래 정보를 파악하면 소셜 커머스 3사 뿐만 아니라 기존 인터넷 상거래 업체를 
통한 쇼핑에도 유용한 정보를 제공하게 된다.

<img src="fig/social-commerce.png" alt="상거래 - 웹트래픽 - 재무정보" width="77%" />

## 2. 소셜 커머스 3사와 인터넷 커머스 3사 웹사이트 순위

### 2.1. 환경설정과 데이터 가져오기

웹트래픽 정보를 알렉사를 통해 수집하기 위한 사전 준비를 하고, 대상 웹사이트를 선별하여 
데이터프레임으로 준비한다. 


~~~{.r}
# 0. 환경설정 ---------------------------------------
library(aws.signature)
library(tidyverse)
library(aws.alexa)
library(rvest)
library(readxl)
library(purrr)
library(extrafont)
library(ggthemes)
loadfonts()

Sys.setenv("AWS_ACCESS_KEY_ID" = "AKIxxxxxxxxxxxxxxxxxxxxxx",
           "AWS_SECRET_ACCESS_KEY" = "wTQxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")

# 1. 데이터 가져오기 --------------------------------

shop_df <- tribble(
    ~name, ~website,
    "쿠팡", "http://www.coupang.com/",
    "11번가", "http://www.11st.co.kr/",
    "티몬", "http://www.ticketmonster.co.kr/",
    "위메프", "http://www.wemakeprice.com/",
    "g마켓", "http://www.gmarket.co.kr/",
    "옥션", "http://www.auction.co.kr/"
)
~~~

### 2.2. 웹트래픽 정보 가져와서 정제

웹트래픽 정보를 가져와서 사람이 이해하기 편한 상태로 데이터를 전처리한다.


~~~{.r}
# 2. 웹페이지 데이터 -----------------------
## 2.1. 홈페이지 정보 긁어오기 -------------

Sys.setlocale("LC_ALL", "English")

shop_hp_info <- map_df(shop_df$website, url_info)

## 2.2. 웹페이지 활동성 데이터 ------------

shop_hp_alexa <- map(shop_df$website, traffic_history)

Sys.setlocale("LC_ALL", "Korean")

names(shop_hp_alexa) <- shop_df$name

for(i in seq_along(shop_df$name)) {
    shop_hp_alexa[[i]] <- shop_hp_alexa[[i]] %>% 
        mutate(company = shop_df$name[i])
}

shop_traffic_df <- map_df(shop_hp_alexa, bind_rows)

shop_traffic_df <- shop_traffic_df %>% 
    mutate(company = factor(company, levels=c("쿠팡", "위메프", "티몬", "11번가", "옥션", "g마켓")))

shop_traffic_df <- shop_traffic_df %>% 
    mutate(일자 = lubridate::ymd(date),
             페이지뷰 = as.numeric(page_views_per_million),
             유저당페이지뷰 = as.numeric(page_views_per_user),
             웹사이트순위 = as.numeric(rank),
             도달수 = as.numeric(reach_per_million)) %>% 
    dplyr::select(일자, 페이지뷰, 유저당페이지뷰, 웹사이트순위, 도달수, 회사=company)
~~~

AWS에서 받아온 정보도 꼼꼼히 살펴보고 [@Alexa](http://www.alexa.com/siteinfo)에서 상호 검증도 진행한다. 


~~~{.r}
listviewer::jsonedit(shop_hp_alexa, mode="view")
~~~

<!--html_preserve--><div id="htmlwidget-c0e77f3bed7b7308abe9" style="width:1152px;height:960px;" class="jsonedit html-widget"></div>
<script type="application/json" data-for="htmlwidget-c0e77f3bed7b7308abe9">{"x":{"data":{"쿠팡":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["55","51","62.6","57","59","56.6","53.4","58.3","41","50","72.7","55.9","50.8","62.9","62.1","45","55","64.1","66.3","82.6","54.7","54.1","46","53","45","60.7","52.6","44","57.3","33","50"],"page_views_per_user":["10.00","13.00","11.00","9.00","9.10","9.70","8.70","9.90","8.10","8.40","11.00","9.40","9.70","9.90","10.00","8.20","10.00","9.50","9.30","12.00","8.10","7.60","9.30","8.90","6.50","9.40","8.10","7.70","9.60","7.00","9.80"],"rank":["2897","4107","3018","2530","2450","2686","2632","2690","3571","2922","2206","2567","3017","2441","2620","3246","3128","2340","2202","2096","2423","2384","3576","2897","2507","2444","2439","2872","2636","3905","3302"],"reach_per_million":["240","160","220","280","280","260","270","250","200","240","310","270","230","280","250","210","210","300","310","310","290","300","190","230","310","280","290","250","260","180","200"],"company":["쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡","쿠팡"]},"11번가":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["90.2","97.3","85.3","122","130","116","114","101","91.8","8.7","132","133","32","94.7","122","86.4","101","119","113","46.8","114","108","96.4","95.7","109","123","121","99.1","85","96.9","108"],"page_views_per_user":["5.60","6.80","5.70","7.10","7.00","6.40","6.60","6.00","6.50","6.80","7.70","7.40","6.40","6.30","7.80","7.10","7.30","6.50","6.70","7.40","6.80","7.10","6.60","7.30","6.80","6.70","7.00","6.60","6.40","7.30","8.10"],"rank":["1009","1157","1165","869","808","838","892","959","1211","14728","828","790","3462","1051","943","1381","1220","829","913","2630","910","1032","1180","1289","946","811","848","999","1175","1214","1183"],"reach_per_million":["690","570","600","770","800","800","760","720","560","52","800","820","220","640","660","460","540","810","740","280","720","640","560","510","710","800","770","670","560","520","540"],"company":["11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가","11번가"]},"티몬":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["24","26","34","33","31","28","34","26","21","24","31","23","42","22","26","28","20","28","32","34","24","28","18","24","27","30","30","32","29","21","26"],"page_views_per_user":["4.90","7.00","6.20","5.30","5.90","4.40","6.60","4.40","4.30","5.50","6.20","4.70","6.50","4.40","6.20","5.80","5.00","5.60","5.50","6.50","4.90","5.40","4.30","5.40","5.90","6.00","5.80","5.60","5.90","5.50","5.80"],"rank":["3929","5083","3435","2955","3447","3014","3393","3275","4288","4643","3386","3748","2633","4062","4332","4050","5193","3665","3118","3372","3923","3727","5053","4560","3972","3623","3378","3024","3661","5141","4248"],"reach_per_million":["210","150","220","270","230","280","230","260","200","180","240","230","280","210","180","190","160","220","260","230","210","210","160","170","200","220","230","260","210","150","180"],"company":["티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬","티몬"]},"위메프":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["29","19","29","36","27","26","44","35","31","27","34","33","26","34","31","24","31","34","35","33","35","27","20","32","33","41","29","34","27","34","23"],"page_views_per_user":["5.50","4.40","4.80","5.50","4.40","4.60","6.30","5.10","5.20","4.80","5.40","5.40","4.60","5.70","5.20","5.00","4.70","5.10","4.90","4.70","5.60","4.00","4.20","4.30","5.20","5.60","4.80","6.60","5.50","7.40","4.00"],"rank":["3581","4867","3314","2722","3082","3280","2491","2771","3320","3695","2825","2879","3417","3033","3118","4178","3085","2771","2573","2703","2885","2974","4557","2776","2895","2474","2942","3272","3653","3920","3620"],"reach_per_million":["220","180","250","290","270","260","310","290","240","220","290","280","240","260","250","190","260","290","310","300","270","280","180","290","280","320","280","230","210","180","230"],"company":["위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프","위메프"]},"g마켓":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["134","132","172","169","163","161","130","131","144","148","163","158","134","132","131","112","155","143","154","168","146","147","120","134","176","165","118","151","123","124","139"],"page_views_per_user":["6.90","7.10","8.60","8.40","7.50","7.50","6.50","6.80","7.50","8.00","7.40","8.00","6.80","6.60","7.20","6.60","8.40","6.30","7.80","8.20","7.00","7.90","7.20","7.20","7.90","8.00","6.20","8.30","6.90","7.30","7.30"],"rank":["768","845","751","687","657","655","760","788","837","848","641","718","761","757","820","973","829","672","729","685","717","790","980","871","645","688","780","763","841","928","813"],"reach_per_million":["830","740","810","900","950","960","880","840","760","750","1000","890","860","860","770","650","720","1000","870","890","910","780","640","730","980","900","850","810","750","670","770"],"company":["g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓","g마켓"]},"옥션":{"date":["2017-06-30","2017-07-01","2017-07-02","2017-07-03","2017-07-04","2017-07-05","2017-07-06","2017-07-07","2017-07-08","2017-07-09","2017-07-10","2017-07-11","2017-07-12","2017-07-13","2017-07-14","2017-07-15","2017-07-16","2017-07-17","2017-07-18","2017-07-19","2017-07-20","2017-07-21","2017-07-22","2017-07-23","2017-07-24","2017-07-25","2017-07-26","2017-07-27","2017-07-28","2017-07-29","2017-07-30"],"page_views_per_million":["83.3","101","119","103","112","94.2","100","90","90.2","94.5","103","93.3","102","88.5","79.8","88.7","79.3","87","89.9","91.1","93.1","79.7","79.2","71.5","85.1","101","79","82.9","69.4","73.4","82.1"],"page_views_per_user":["6.40","7.70","8.20","7.10","7.50","6.70","7.50","6.40","7.40","7.60","7.40","6.20","7.50","7.00","6.10","7.30","6.80","6.40","6.50","6.50","6.50","6.10","6.60","6.30","6.10","7.00","6.20","6.40","5.90","6.20","7.10"],"rank":["1217","1253","1085","1044","1014","1081","1127","1120","1373","1345","1072","1032","1109","1222","1251","1374","1491","1168","1143","1104","1103","1279","1453","1571","1135","1056","1194","1194","1385","1454","1448"],"reach_per_million":["560","520","590","640","650","620","590","610","480","500","640","680","600","550","550","460","450","600","600","610","620","550","460","440","620","630","580","580","510","460","460"],"company":["옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션","옥션"]}},"options":{"mode":"view","modes":["code","form","text","tree","view"]}},"evals":[],"jsHooks":[]}</script><!--/html_preserve-->

## 3. 소셜 커머스/인터넷 커머스 3사 웹트래픽

### 3.1. 순위

아마존 알렉사 기준 웹사이트 순위(rank)를 ggplot으로 시각화한다.


~~~{.r}
# 3. 회사별 웹페이지 시각화 ------------

ggplot(shop_traffic_df, aes(x=일자, y=웹사이트순위, color=회사)) +
    geom_line() +
    geom_point(size=2) +
    scale_y_log10(labels = scales::comma) +
    theme_bw(base_family="NanumGothic") +
    labs(x="", y="웹사이트 순위", title="아마존 알렉사 웹사이트 순위",
         subtitle="2017-08-02 기준, 인터넷쇼핑 3사, 모바일쇼핑 3사")
~~~

<img src="fig/social-web-ranking-1.png" style="display: block; margin: auto;" />

### 3.2. 페이지뷰(PageView)

아마존 알렉사 기준 웹사이트 페이지뷰(PageView)를 ggplot으로 시각화한다.


~~~{.r}
ggplot(shop_traffic_df, aes(x=일자, y=페이지뷰, color=회사)) +
    geom_line() +
    geom_point(size=2) +
    scale_y_continuous(labels = scales::comma) +
    theme_bw(base_family="NanumGothic") +
    labs(x="", y="페이지뷰(Page View)", title="아마존 알렉사 웹사이트 순위",
         subtitle="2017-08-02 기준, 인터넷쇼핑 3사, 모바일쇼핑 3사")
~~~

<img src="fig/social-web-pageview-1.png" style="display: block; margin: auto;" />

### 3.3. 유저당 페이지뷰

아마존 알렉사 기준 웹사이트 유저당 페이지뷰를 ggplot으로 시각화한다.


~~~{.r}
ggplot(shop_traffic_df, aes(x=일자, y=유저당페이지뷰, color=회사)) +
    geom_line() +
    geom_point(size=2) +
    scale_y_continuous(labels = scales::comma) +
    theme_bw(base_family="NanumGothic") +
    labs(x="", y="유저별 페이지뷰", title="아마존 알렉사 웹사이트 순위",
         subtitle="2017-08-02 기준, 인터넷쇼핑 3사, 모바일쇼핑 3사")
~~~

<img src="fig/social-web-pageview-per-user-1.png" style="display: block; margin: auto;" />
