<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: 데이터 과학</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-16', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://xwmooc.net" title="xwMOOC">
          <img alt="xwMOOC banner" src="img/xwMOOC.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">데이터 과학</h1>
          <h2 class="subtitle">지리정보 시각화 - ggmap</h2>
<section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="학습-목표"><span class="glyphicon glyphicon-certificate"></span>학습 목표</h2>
</div>
<div class="panel-body">
<ul>
<li><code>ggmap</code></li>
</ul>
</div>
</section>
<p><sub>~</sub> {.r kor-map} setwd(“~/Dropbox/01_data_science”)</p>
<h4 id="패키지-로딩-데이터-읽어오기">패키지 로딩 &amp; 데이터 읽어오기</h4>
<p>library(“ggplot2”) library(“ggmap”) library(“sp”) library(“maptools”) library(“dplyr”)</p>
<p>kor.map.shp = readShapePoly(“kor-map/센서스용_행정구역경계_2013_시군구/BND_SIGUNGU_PG.shp”) kor.map = fortify(korea.map.shp) head(kor.map) ggplot(kor.map, aes(long, lat)) + geom_polygon()</p>
<p>m &lt;- ggplot(kor.map, aes(long, lat)) + geom_polygon(fill = “white”, colour = “blue”) m <sub>~</sub></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bd &lt;-<span class="st"> </span><span class="kw">subset</span>(korea_map_shp, korea_map_shp$sigungu_nm %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;성남시수정구&quot;</span>,<span class="st">&quot;성남시중원구&quot;</span>, <span class="st">&quot;성남시분당구&quot;</span>))</code></pre></div>
<pre class="output"><code>Error in subset(korea_map_shp, korea_map_shp$sigungu_nm %in% c(&quot;성남시수정구&quot;, : 객체 &#39;korea_map_shp&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bd</code></pre></div>
<pre class="output"><code>Error in eval(expr, envir, enclos): 객체 &#39;bd&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> bd, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">colour =</span> id)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">fill =</span> <span class="st">&quot;#FFFFFF&quot;</span>)</code></pre></div>
<pre class="output"><code>Error in eval(expr, envir, enclos): 함수 &quot;ggplot&quot;를 찾을 수 없습니다
</code></pre>
<h5 id="gis-데이터">GIS 데이터</h5>
<p>지리정보시스템(GIS) 데이터 처리를 위한 기본 R 팩키지를 설치한다.</p>
<p><a href="http://www.rdocumentation.org/packages/rgdal">rgdal</a>, <a href="http://www.rdocumentation.org/packages/raster">raster</a>, <a href="http://www.rdocumentation.org/packages/sp">sp</a>를 3종세트로 GIS 데이터 처리를 시작해 본다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;raster&quot;</span>) <span class="co"># Geographic data analysis and modeling</span>
<span class="kw">install.packages</span>(<span class="st">&quot;rgdal&quot;</span>) <span class="co"># Bindings for the Geospatial Data Abstraction Library</span>
<span class="kw">install.packages</span>(<span class="st">&quot;sp&quot;</span>) <span class="co"># Classes and Methods for Spatial Data</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#===========================</span>
<span class="co"># 필요한 라이브러리를 메모리에 적재한다.</span>
<span class="co">#===========================</span>
<span class="kw">library</span>(<span class="st">&quot;sp &quot;</span>, <span class="st">&quot;rgdal&quot;</span>, <span class="st">&quot;raster&quot;</span>)

<span class="co">#===========================</span>
<span class="co"># 지리정보 데이터 정보</span>
<span class="co"># ㄴ 원본 .sph 데이터: http://biogeo.ucdavis.edu/data/gadm2/shp/KOR_adm.zip</span>
<span class="co">#===========================</span>


<span class="co">#===========================</span>
<span class="co"># 작업 디렉토리를 생성한다.</span>
<span class="co">#===========================</span>
localDir &lt;-<span class="st"> &#39;KOR_GIS_data&#39;</span>
if (!<span class="kw">file.exists</span>(localDir)) {
    <span class="kw">dir.create</span>(localDir)
}

<span class="co">#===========================</span>
<span class="co"># 데이터를 불러와서 압축을 푼다.</span>
<span class="co">#===========================</span>
url &lt;-<span class="st"> &#39;http://biogeo.ucdavis.edu/data/gadm2/shp/KOR_adm.zip&#39;</span>
file &lt;-<span class="st"> </span><span class="kw">paste</span>(localDir,<span class="kw">basename</span>(url),<span class="dt">sep=</span><span class="st">&#39;/&#39;</span>)
if (!<span class="kw">file.exists</span>(file)) {
    <span class="kw">download.file</span>(url, file)
    <span class="kw">unzip</span>(file,<span class="dt">exdir=</span>localDir)
}

<span class="co"># list.files(localDir)</span>

<span class="co">#===========================</span>
<span class="co"># 계층을 설정하고, 내부정보를 살펴본다.</span>
<span class="co">#===========================</span>

<span class="co"># .shp 파일에서 파일 확장자를 제거한 계층명칭이된다.</span>
layer_KOR_adm0 &lt;-<span class="st"> &quot;KOR_adm0&quot;</span>  
layer_KOR_adm1 &lt;-<span class="st"> &quot;KOR_adm1&quot;</span>  
layer_KOR_adm2 &lt;-<span class="st"> &quot;KOR_adm2&quot;</span>  

<span class="co"># 데이터를 불러온다.</span>
KOR_adm0_projected &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span>localDir, <span class="dt">layer=</span>layer_KOR_adm0) 
KOR_adm1_projected &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span>localDir, <span class="dt">layer=</span>layer_KOR_adm1) 
KOR_adm2_projected &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="dt">dsn=</span>localDir, <span class="dt">layer=</span>layer_KOR_adm2) 

<span class="co">#class(KOR_adm0_projected)</span>
<span class="co">#slotNames(KOR_adm0_projected)</span>

<span class="co"># 행정구역 정보 시각화</span>
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw">plot</span>(KOR_adm0_projected)
<span class="kw">plot</span>(KOR_adm1_projected)
<span class="kw">plot</span>(KOR_adm2_projected)</code></pre></div>
<p><img src="fig/korea-admin-level.png" alt="대한민국 행정구역" width="70%" /></p>
<p><a href="http://mazamascience.com/WorkingWithData/?p=1277">Using R - Working with Geospatial Data</a> <a href="http://neondataskills.org/R/Raster-Data-In-R/">Raster Data in R - The Basics</a></p>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://xwmooc.net">xwMOOC</a>
        <a class="label swc-blue-bg" href="https://github.com/statkclee/data-science">Source</a>
        <a class="label swc-blue-bg" href="mailto:i@xwmooc.net">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
